@import models.formdata.EventForm

@(eventForm: Form[EventForm], editingEvent: Option[models.Event] = None, extraValues: models.viewmodels.EditEventExtraValues)(implicit flash: Flash = Flash.emptyCookie, request: RequestHeader, messages: Messages, appContext: AppContext)

@script = {
    <script>
    $(document).ready(function(){
        var formValRules = {
            ignore:":not(:visible)",
            rules: {
                name : "required"
            },
            messages: {
                name: {
                    required: '@{Messages("event.edit.add.name.validation")}'
                }
            }
        };

        $('.form-control.date input[type=date]').datetimepicker(
            {
            locale: 'sv',
            sideBySide: true,
            stepping: 30
            }
        );
        initMultiForm(formValRules);

    });
    </script>
}
@main(Messages("event.create.title"), footerHtml = file.modalImages.render(messages), footerScripts = script){

    <div class="container maincontent-container">
        <div class="row">
            <div class="col-xs-12 col-sm-8 col-sm-offset-2">
                <h1 class="page-header">@Messages("event.edit.add.header")</h1>

                <div class="progress">
                    <div class="progress-bar progress-bar-orange active" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                @shared.flashmsg(flash)

                @helper.form(action=controllers.routes.EventPageController.addSubmit(), 'enctype -> "multipart/form-data", 'class -> "form-multistep form-horizontal"){
                    <fieldset>
                        <div class="step">
                            @helper.inputText(eventForm("name"), '_label -> Messages("event.edit.add.name"), '_help -> "*")
                            <div class="margin-top">@Html(Messages("event.edit.add.name.help-text"))</div>
                        </div>

                        <div class="step">
                            @helper.textarea(eventForm("body"), '_label -> Messages("event.edit.add.body"), 'class -> "richtext-extra")
                            <div class="margin-top">@Html(Messages("event.edit.add.body.help-text"))</div>
                        </div>

                        <div class="step">
                            @helper.textarea(eventForm("preamble"), '_label -> Messages("event.edit.add.preamble"), '_help -> Messages("event.edit.add.preamble.validation"), '_class -> "event-addedit-form-preamble")
                            <div class="margin-top">@Html(Messages("event.edit.add.preamble.help-text"))</div>
                        </div>

                        <div class="step">
                            @helper.repeat(field = eventForm("eventDates"), min = 1) { eventDatesField =>
                                <div class="form-group">
                                    <div class="input-group date">
                                        @helper.inputDate(eventDatesField("date"), '_label -> Messages("event.edit.add.date"), '_help -> Messages("event.edit.add.date.validation"), '_class -> "form-control date")
                                        @helper.inputHidden(eventDatesField("id"))
                                        @helper.inputHidden(eventDatesField("guestsbooked"))
                                        <span class="input-group-addon">
                                            <span class="glyphicon glyphicon-calendar"></span>
                                        </span>
                                    </div>
                                </div>
                            }
                            <div class="margin-top">@Html(Messages("event.edit.add.date.help-text"))</div>
                        </div>

                        <div class="step">
                            <div class="panel panel-default">
                                <div class="panel-body">
                                    <label>@Messages("event.edit.add.main-image")</label><br>
                                    @file.previewField(previewId = "mainimage", Messages("event.edit.add.main-image-preview"), blnShowText = false, prePopulatedWith = extraValues.mainImagePrev)
                                    @file.openModalButton(btnId = "btnmainimg", inputSelector = "mainimage", selectorMaxItems = extraValues.mainImageMaxNr, btnText = Messages("event.edit.add.main-image-btn"))
                                    @helper.inputHidden(eventForm("mainimage"), 'id -> "mainimage")
                                </div>
                            </div>
                        </div>

                        <div class="step">
                            <div class="panel panel-default">
                                <div class="panel-body">
                                    <label>@Messages("event.edit.add.images", extraValues.imagesMaxNr)</label><br>
                                    @file.previewField(previewId = "images", Messages("event.edit.add.images-preview"), blnShowText = false, prePopulatedWith = extraValues.imagesPrev)
                                    @file.openModalButton(btnId = "btnimages", inputSelector = "images", selectorMaxItems = extraValues.imagesMaxNr, btnText = Messages("event.edit.add.images-btn"))
                                    @helper.inputHidden(eventForm("images"), 'id -> "images")
                                </div>
                            </div>
                        </div>

                        @helper.inputHidden(eventForm("id"))
                    </fieldset>

                    <hr class="hr-orange">
                    <div class="form-actions">
                        <button class="btn btn-default pull-left action prev" type="button"><span class="glyphicon glyphicon-chevron-left"></span>&nbsp;@Messages("event.edit.prev")</button>
                        <button class="btn btn-default pull-right action next" type="button">@Messages("event.edit.next")&nbsp;<span class="glyphicon glyphicon-chevron-right"></span></button>
                        <button class="btn btn-lg btn-orange pull-right action submit" type="submit"><span class="glyphicon glyphicon-floppy-disk"></span>&nbsp;@Messages("event.edit.save")</button>
                        @if(eventForm("id").value.nonEmpty) {
                            <a class="btn btn-danger pull-right action delete" data-confirm-type="link" data-confirm-btn-ok="@Messages("event.edit.delete.ok")" data-confirm-title="@Messages("event.edit.delete.title")" data-confirm-btn-cancel="@Messages("event.edit.delete.abort")" data-confirm-text="@Messages("event.edit.delete.confirm")" href="@controllers.routes.EventPageController.delete(java.util.UUID.fromString(eventForm("id").value.get))"><span class="glyphicon glyphicon-trash"></span>&nbsp;@Messages("event.edit.delete")</a>
                        }
                        @defining(if(editingEvent.isDefined){
                            controllers.routes.EventPageController.viewEventByNameAndProfile(editingEvent.get.getOwnerProfile.profileLinkName,editingEvent.get.getLink).url
                        }else{
                            controllers.routes.UserProfileController.viewProfileByLoggedInUser().url
                        }) { abortLink =>
                            <a class="btn action pull-right abort" data-loading-text="@Messages("event.edit.saving")" href="@abortLink">@Messages("event.edit.abort")</a>
                        }
                    </div>
                }
            </div>
        </div>
    </div>
}